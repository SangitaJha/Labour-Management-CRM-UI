<!DOCTYPE html>
<html>
<head>
  <title>Settings</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="js/auth.js"></script>
  <style>
    .settings-container {
      max-width: 900px;
      margin: 30px auto;
    <div class="crm-layout">
      <aside class="crm-sidebar">
        <div class="sidebar-logo">
          <img src="https://img.icons8.com/ios-filled/50/667eea/construction-worker.png" alt="Logo" />
          <span>SVF CRM</span>
        </div>
        <nav class="sidebar-nav">
          <a href="index.html"><i class="fas fa-home"></i> Home</a>
          <a href="dashboard.html"><i class="fas fa-chart-pie"></i> Dashboard</a>
          <a href="attendance.html"><i class="fas fa-calendar-check"></i> Attendance</a>
          <a href="payments.html"><i class="fas fa-rupee-sign"></i> Payments</a>
          <a href="workers.html"><i class="fas fa-users"></i> Workers</a>
          <a href="projects.html"><i class="fas fa-building"></i> Projects</a>
          <a href="reports.html"><i class="fas fa-chart-line"></i> Reports</a>
          <a href="settings.html" class="active"><i class="fas fa-cog"></i> Settings</a>
          <a href="login.html"><i class="fas fa-sign-in-alt"></i> Login</a>
        </nav>
      </aside>
      <main class="crm-main">
        <header class="crm-header">
          <div class="header-title">
            <h1>Settings</h1>
            <span class="header-desc">Manage your CRM preferences, user roles, and more.</span>
          </div>
        </header>
        <section class="dashboard-content">
          <div class="settings-grid">
            <div class="settings-nav">
              <button>Profile</button>
              <button>Account</button>
              <button>Notifications</button>
              <button>Security</button>
              <button>Integrations</button>
            </div>
            <div class="settings-content">
              <!-- Settings content here -->
            </div>
          </div>
        </section>
        <footer class="crm-footer">
          <p>&copy; 2025 SVF Labour Management CRM. All rights reserved.</p>
        </footer>
      </main>
    </div>
    }

    .settings-grid {
      display: grid;
      grid-template-columns: 250px 1fr;
      gap: 30px;
    }

    .settings-nav {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      height: fit-content;
      position: sticky;
      top: 20px;
    }

    .settings-nav button {
      width: 100%;
      padding: 15px 20px;
      border: none;
      background: none;
      text-align: left;
      cursor: pointer;
      font-size: 14px;
      color: #555;
      transition: all 0.3s ease;
      border-left: 3px solid transparent;
    }

    .settings-nav button:hover {
      background: #f8f9fa;
      color: #667eea;
    }

    .settings-nav button.active {
      background: #f8f9fa;
      color: #667eea;
      border-left-color: #667eea;
      font-weight: 600;
    }

    .settings-content {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .settings-section {
      display: none;
    }

    .settings-section.active {
      display: block;
    }

    .settings-section h3 {
      font-size: 20px;
      color: #2c3e50;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid #f0f0f0;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #555;
      font-weight: 500;
      font-size: 14px;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
      transition: all 0.3s ease;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .form-help {
      font-size: 12px;
      color: #999;
      margin-top: 5px;
    }

    .btn-group {
      display: flex;
      gap: 10px;
      margin-top: 25px;
    }

    .btn {
      padding: 12px 30px;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: #e0e0e0;
      color: #333;
    }

    .btn-secondary:hover {
      background: #d0d0d0;
    }

    .btn-danger {
      background: #ff6b6b;
      color: white;
    }

    .btn-danger:hover {
      background: #ee5a52;
    }

    .alert {
      padding: 12px 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 14px;
      display: none;
    }

    .alert.show {
      display: block;
    }

    .alert.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .alert.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .setting-item {
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .setting-item-left h4 {
      margin: 0 0 5px;
      color: #2c3e50;
      font-size: 14px;
    }

    .setting-item-left p {
      margin: 0;
      color: #999;
      font-size: 12px;
    }

    .back-button {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      color: #667eea;
      text-decoration: none;
      font-weight: 600;
      margin-bottom: 20px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .back-button:hover {
      gap: 15px;
    }

    @media (max-width: 768px) {
      .settings-grid {
        grid-template-columns: 1fr;
      }

      .settings-nav {
        display: flex;
        flex-direction: row;
        overflow-x: auto;
        position: static;
      }

      .settings-nav button {
        border-left: none;
        border-bottom: 3px solid transparent;
        white-space: nowrap;
        flex: 1;
      }

      .settings-nav button.active {
        border-left: none;
        border-bottom-color: #667eea;
      }
    }
  </style>
</head>
<body>
  <!-- Left Sidebar -->
  <div class="sidebar">
    <h2 class="sidebar-brand">Labour CRM</h2>
    <nav class="sidebar-nav">
      <a href="dashboard.html" class="sidebar-item">
        <i class="fas fa-home"></i>
        <span>Dashboard</span>
        <i class="fas fa-chevron-right arrow"></i>
      </a>
      <a href="attendance.html" class="sidebar-item">
        <i class="fas fa-clipboard-check"></i>
        <span>Attendance</span>
        <i class="fas fa-chevron-right arrow"></i>
      </a>
      <a href="workers.html" class="sidebar-item">
        <i class="fas fa-users"></i>
        <span>Workers</span>
        <i class="fas fa-chevron-right arrow"></i>
      </a>
      <a href="contractors.html" class="sidebar-item">
        <i class="fas fa-hard-hat"></i>
        <span>Contractors</span>
        <i class="fas fa-chevron-right arrow"></i>
      </a>
      <a href="payments.html" class="sidebar-item">
        <i class="fas fa-money-bill-wave"></i>
        <span>Payments</span>
        <i class="fas fa-chevron-right arrow"></i>
      </a>
      <a href="reports.html" class="sidebar-item">
        <i class="fas fa-chart-bar"></i>
        <span>Reports</span>
        <i class="fas fa-chevron-right arrow"></i>
      </a>
    </nav>
  </div>

  <!-- Main Content -->
  <div class="content">
    <!-- Top Header Bar -->
    <div class="header">
      <div class="header-left">
        <h1>Settings</h1>
      </div>
      <div class="header-right">
        <div class="breadcrumb">
          <span>Account</span> / <span>Settings</span>
        </div>
        <div class="user-profile-menu">
          <div class="user-info">
            <span id="userNameDisplay">Guest</span>
            <span id="userRoleDisplay" class="user-role-badge"></span>
          </div>
          <button class="user-menu-btn" onclick="toggleUserMenu()">
            <i class="fas fa-user-circle"></i>
            <i class="fas fa-chevron-down"></i>
          </button>
          <div id="userDropdown" class="user-dropdown">
            <a href="#" onclick="goToProfile()"><i class="fas fa-user"></i> Profile</a>
            <a href="#" onclick="goToSettings()"><i class="fas fa-cog"></i> Settings</a>
            <hr>
            <a href="#" onclick="logout()" style="color: #d32f2f;"><i class="fas fa-sign-out-alt"></i> Logout</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Settings Container -->
    <div class="settings-container">
      <a class="back-button" onclick="window.history.back()">
        <i class="fas fa-arrow-left"></i>
        Go Back
      </a>

      <div class="settings-header">
        <h2>Account Settings</h2>
        <p>Manage your account preferences and security</p>
      </div>

      <div class="settings-grid">
        <!-- Settings Navigation -->
        <div class="settings-nav">
          <button class="active" onclick="showSection('password')">
            <i class="fas fa-lock"></i> Change Password
          </button>
          <button onclick="showSection('notifications')">
            <i class="fas fa-bell"></i> Notifications
          </button>
          <button onclick="showSection('privacy')">
            <i class="fas fa-shield-alt"></i> Privacy
          </button>
          <button onclick="showSection('sessions')">
            <i class="fas fa-desktop"></i> Active Sessions
          </button>
          <button onclick="showSection('danger')">
            <i class="fas fa-exclamation-triangle"></i> Danger Zone
          </button>
        </div>

        <!-- Settings Content -->
        <div class="settings-content">
          <!-- Password Section -->
          <div id="password" class="settings-section active">
            <h3>Change Password</h3>
            <div id="passwordAlert" class="alert"></div>
            <form onsubmit="changePassword(event)">
              <div class="form-group">
                <label>Current Password</label>
                <input type="password" id="currentPassword" required placeholder="Enter your current password">
              </div>
              <div class="form-group">
                <label>New Password</label>
                <input type="password" id="newPassword" required placeholder="Enter new password (min 6 characters)">
                <div class="form-help">Password must be at least 6 characters long</div>
              </div>
              <div class="form-group">
                <label>Confirm New Password</label>
                <input type="password" id="confirmPassword" required placeholder="Confirm your new password">
              </div>
              <div class="btn-group">
                <button type="submit" class="btn btn-primary">Update Password</button>
              </div>
            </form>
          </div>

          <!-- Notifications Section -->
          <div id="notifications" class="settings-section">
            <h3>Notification Preferences</h3>
            <div class="setting-item">
              <div class="setting-item-left">
                <h4>Email Notifications</h4>
                <p>Receive updates via email</p>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" checked>
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="setting-item">
              <div class="setting-item-left">
                <h4>Attendance Reminders</h4>
                <p>Get reminders for attendance marking</p>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" checked>
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="setting-item">
              <div class="setting-item-left">
                <h4>Payment Notifications</h4>
                <p>Get alerts for payment updates</p>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" checked>
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="btn-group" style="margin-top: 25px;">
              <button class="btn btn-primary" onclick="saveNotifications()">Save Preferences</button>
            </div>
          </div>

          <!-- Privacy Section -->
          <div id="privacy" class="settings-section">
            <h3>Privacy Settings</h3>
            <div class="setting-item">
              <div class="setting-item-left">
                <h4>Profile Visibility</h4>
                <p>Control who can see your profile</p>
              </div>
              <select style="width: 150px;">
                <option>Private</option>
                <option>Team Only</option>
                <option>Public</option>
              </select>
            </div>
            <div class="setting-item">
              <div class="setting-item-left">
                <h4>Activity Status</h4>
                <p>Show when you're online</p>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" checked>
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="btn-group" style="margin-top: 25px;">
              <button class="btn btn-primary" onclick="savePrivacy()">Save Privacy Settings</button>
            </div>
          </div>

          <!-- Sessions Section -->
          <div id="sessions" class="settings-section">
            <h3>Active Sessions</h3>
            <div class="setting-item">
              <div class="setting-item-left">
                <h4>Current Session</h4>
                <p>Chrome on Windows • This browser</p>
                <p style="color: #28a745; margin-top: 5px;">Active now</p>
              </div>
              <button class="btn btn-secondary" disabled>Current</button>
            </div>
            <div class="setting-item">
              <div class="setting-item-left">
                <h4>Other Active Sessions</h4>
                <p>Firefox on MacOS • Last active 2 hours ago</p>
              </div>
              <button class="btn btn-danger" onclick="logout()">Sign Out</button>
            </div>
          </div>

          <!-- Danger Zone -->
          <div id="danger" class="settings-section">
            <h3>Danger Zone</h3>
            <div class="setting-item">
              <div class="setting-item-left">
                <h4 style="color: #d32f2f;">Delete Account</h4>
                <p>Once you delete your account, there is no going back. Please be certain.</p>
              </div>
              <button class="btn btn-danger">Delete Account</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <style>
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 28px;
      cursor: pointer;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: 0.4s;
      border-radius: 28px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 22px;
      width: 22px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: 0.4s;
      border-radius: 50%;
    }

    input:checked + .toggle-slider {
      background-color: #667eea;
    }

    input:checked + .toggle-slider:before {
      transform: translateX(22px);
    }
  </style>

  <script>
    const API_URL = 'http://localhost:3000/api';

    function showSection(sectionId) {
      // Hide all sections
      document.querySelectorAll('.settings-section').forEach(el => {
        el.classList.remove('active');
      });

      // Remove active from all buttons
      document.querySelectorAll('.settings-nav button').forEach(btn => {
        btn.classList.remove('active');
      });

      // Show selected section
      document.getElementById(sectionId).classList.add('active');
      event.target.closest('button').classList.add('active');
    }

    async function changePassword(event) {
      event.preventDefault();

      const currentPassword = document.getElementById('currentPassword').value;
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;

      if (newPassword.length < 6) {
        showAlert('passwordAlert', 'Password must be at least 6 characters', 'error');
        return;
      }

      if (newPassword !== confirmPassword) {
        showAlert('passwordAlert', 'Passwords do not match', 'error');
        return;
      }

      try {
        const response = await apiRequest('/auth/change-password', {
          method: 'POST',
          body: JSON.stringify({ currentPassword, newPassword })
        });

        if (response.success) {
          showAlert('passwordAlert', 'Password changed successfully!', 'success');
          document.getElementById('currentPassword').value = '';
          document.getElementById('newPassword').value = '';
          document.getElementById('confirmPassword').value = '';
        } else {
          showAlert('passwordAlert', response.error || 'Failed to change password', 'error');
        }
      } catch (error) {
        showAlert('passwordAlert', 'Error changing password', 'error');
      }
    }

    function saveNotifications() {
      alert('✓ Notification preferences saved successfully!');
    }

    function savePrivacy() {
      alert('✓ Privacy settings saved successfully!');
    }

    function showAlert(elementId, message, type) {
      const alertBox = document.getElementById(elementId);
      alertBox.textContent = message;
      alertBox.className = `alert show ${type}`;
      setTimeout(() => {
        alertBox.className = 'alert';
      }, 5000);
    }
  </script>
</body>
</html>
