<!DOCTYPE html>
<html>
<head>
  <title>Sites</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="js/auth.js"></script>
  <style>
    .page-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 30px;
      border-radius: 12px;
      margin-bottom: 30px;
      color: white;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    .page-header h1 { margin: 0; font-size: 32px; font-weight: 600; }
    .page-header p { margin: 8px 0 0 0; font-size: 16px; opacity: 0.9; }
    .stats-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      display: flex;
      align-items: center;
      gap: 15px;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .stat-card:hover { transform: translateY(-3px); box-shadow: 0 4px 15px rgba(0,0,0,0.12); }
    .stat-icon {
      width: 60px;
      height: 60px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      color: white;
    }
    .stat-icon.blue { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .stat-icon.green { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
    .stat-icon.orange { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
    .stat-content h3 { margin: 0; font-size: 14px; color: #6c757d; font-weight: 500; }
    .stat-content .stat-value { margin: 5px 0 0 0; font-size: 28px; font-weight: 700; color: #2c3e50; }
    .site-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); gap: 25px; margin: 20px 0; }
    .site-card { 
      background: white; 
      border-radius: 12px; 
      padding: 25px; 
      box-shadow: 0 2px 12px rgba(0,0,0,0.08); 
      transition: transform 0.3s, box-shadow 0.3s; 
      cursor: pointer; 
      border: 2px solid transparent;
      position: relative;
      overflow: hidden;
    }
    .site-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .site-card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2); border-color: #667eea; }
    .site-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 18px; }
    .site-name { font-size: 18px; font-weight: 700; color: #2c3e50; line-height: 1.3; }
    .site-code { font-size: 13px; color: white; padding: 5px 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; font-weight: 600; }
    .site-location { display: flex; align-items: center; gap: 8px; color: #6c757d; font-size: 14px; margin: 10px 0; }
    .site-location i { color: #667eea; }
    .site-btn { margin-top: 15px; padding-top: 15px; border-top: 1px solid #f0f0f0; }
    .site-btn a {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      text-decoration: none;
      display: inline-block;
      text-align: center;
      font-weight: 600;
      transition: transform 0.2s, box-shadow 0.2s;
      width: 100%;
    }
    .site-btn a:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); }
    .work-type-box { background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); cursor: pointer; transition: all 0.3s; border: 2px solid transparent; }
    .work-type-box:hover { box-shadow: 0 4px 15px rgba(102, 126, 234, 0.15); border-color: #667eea; }
    .site-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .site-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    .site-name { font-size: 18px; font-weight: 600; color: #2c3e50; }
    .site-code { font-size: 14px; color: #6c757d; padding: 4px 8px; background: #e9ecef; border-radius: 4px; }
    
    .work-type-box { background: #fff; border-radius: 8px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); cursor: pointer; transition: all 0.2s; }
    .work-type-box:hover { box-shadow: 0 4px 10px rgba(0,0,0,0.15); }
    .work-type-header { display: flex; justify-content: space-between; align-items: center; }
    .work-type-title { font-size: 16px; font-weight: 600; color: #2c3e50; display: flex; align-items: center; gap: 10px; }
    .work-type-badge { background: #007bff; color: #fff; padding: 4px 12px; border-radius: 12px; font-size: 12px; }
    .work-details { margin-top: 15px; padding-top: 15px; border-top: 1px solid #e9ecef; display: none; }
    .work-details.expanded { display: block; }
    .worker-item { padding: 10px; background: #f8f9fa; border-radius: 4px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
    .worker-name { font-weight: 500; color: #495057; }
    .worker-role { font-size: 13px; color: #6c757d; padding: 3px 8px; background: #e9ecef; border-radius: 10px; }
    
    .filter-bar { background: #fff; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; gap: 15px; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.08); }
    .filter-bar select, .filter-bar input { padding: 8px 12px; border: 1px solid #ced4da; border-radius: 4px; font-size: 14px; }
    .muted { color: #6c757d; font-size: 13px; }
    .link { color:#007bff; text-decoration:none; }
    .link:hover { text-decoration:underline; }
  </style>
  </head>
<body>
  <div class="sidebar">
    <h2 class="sidebar-brand">Labor Attendance</h2>
    <nav class="sidebar-nav">
      <a href="dashboard.html" class="sidebar-item"><i class="fas fa-home"></i><span>Dashboard</span></a>
      <a href="workers.html" class="sidebar-item"><i class="fas fa-users"></i><span>Labour</span></a>
      <a href="contractors.html" class="sidebar-item"><i class="fas fa-user-tie"></i><span>Contractors</span></a>
      <a href="attendance.html" class="sidebar-item"><i class="fas fa-calendar-check"></i><span>Attendance</span></a>
      <a href="payments.html" class="sidebar-item"><i class="fas fa-money-bill-wave"></i><span>Wages & Payments</span></a>
      <a href="projects.html" class="sidebar-item"><i class="fas fa-building"></i><span>Projects</span></a>
      <a href="reports.html" class="sidebar-item"><i class="fas fa-chart-bar"></i><span>Reports</span></a>
    </nav>
  </div>

  <div class="content">
    <div class="page-header">
      <h1><i class="fas fa-map-marked-alt"></i> Sites Management</h1>
      <p>Manage 10 construction sites with complete contractor and worker details</p>
    </div>

    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-icon blue">
          <i class="fas fa-building"></i>
        </div>
        <div class="stat-content">
          <h3>Total Sites</h3>
          <div class="stat-value">10</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon green">
          <i class="fas fa-users"></i>
        </div>
        <div class="stat-content">
          <h3>Total Contractors</h3>
          <div class="stat-value">100</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon orange">
          <i class="fas fa-hard-hat"></i>
        </div>
        <div class="stat-content">
          <h3>Total Workers</h3>
          <div class="stat-value">250+</div>
        </div>
      </div>
    </div>

    <div class="filter-bar">
      <select id="filterSite" onchange="loadSite()">
        <option value="">Select Site</option>
        <option value="1">Site 1 - Foundation Work</option>
        <option value="2">Site 2 - Structural Work</option>
        <option value="3">Site 3 - Finishing</option>
        <option value="4">Site 4 - Plumbing</option>
        <option value="5">Site 5 - Electrical</option>
        <option value="6">Site 6 - Landscaping</option>
        <option value="7">Site 7 - Painting</option>
        <option value="8">Site 8 - Roofing</option>
        <option value="9">Site 9 - Interiors</option>
        <option value="10">Site 10 - Finalization</option>
      </select>
      <span class="muted">Or click on any site card below to view details</span>
    </div>

  <h2 class="section-title"><i class="fas fa-th-large"></i> All Sites</h2>
    <div class="site-grid" id="allSitesGrid"></div>

    <div id="siteDetailsSection" style="display:none; margin-top: 30px;">
      <h2 style="margin-bottom: 15px;">Site Details: <span id="currentSiteName"></span></h2>
      
      <h3 style="margin: 25px 0 15px 0;">Contractors & Work Types</h3>
      <div id="workTypesContainer"></div>
    </div>
  </div>

  <script>
    let currentSiteId = null;

    function getParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    const workTypeData = {
      'civil': { 
        icon: 'fa-building', 
        workers: [
          { name: 'Rajesh Kumar', role: 'Mason', wage: 600, inTime: '08:00 AM', outTime: '05:00 PM', workData: '25 sq.m' },
          { name: 'Suresh Yadav', role: 'Helper', wage: 400, inTime: '08:00 AM', outTime: '05:00 PM', workData: '30 sq.m' },
          { name: 'Amit Singh', role: 'Mason', wage: 650, inTime: '08:00 AM', outTime: '05:00 PM', workData: '28 sq.m' }
        ],
        materials: [
          { name: 'Cement', quantity: '50', unit: 'bags', cost: 'â‚¹350/bag' },
          { name: 'Brick', quantity: '5000', unit: 'pcs', cost: 'â‚¹6/pc' },
          { name: 'M.Sand', quantity: '100', unit: 'cu.m', cost: 'â‚¹1500/cu.m' },
          { name: 'Steel', quantity: '5', unit: 'ton', cost: 'â‚¹45000/ton' }
        ]
      },
      'centring': { 
        icon: 'fa-hammer', 
        workers: [
          { name: 'Vijay Kumar', role: 'Bar Bender', wage: 550, inTime: '08:00 AM', outTime: '05:00 PM', workData: '2 ton' },
          { name: 'Ravi Sharma', role: 'Helper', wage: 400, inTime: '08:00 AM', outTime: '05:00 PM', workData: '1.5 ton' }
        ],
        materials: [
          { name: 'Steel', quantity: '10', unit: 'ton', cost: 'â‚¹45000/ton' },
          { name: 'Jally', quantity: '200', unit: 'pcs', cost: 'â‚¹50/pc' },
          { name: 'Wire', quantity: '50', unit: 'kg', cost: 'â‚¹150/kg' },
          { name: 'M.Sand', quantity: '50', unit: 'cu.m', cost: 'â‚¹1500/cu.m' }
        ]
      },
      'sand-filling': { 
        icon: 'fa-truck', 
        workers: [
          { name: 'Mohan Lal', role: 'Operator', wage: 500, inTime: '07:00 AM', outTime: '04:00 PM', workData: '100 cu.m' },
          { name: 'Prakash', role: 'Helper', wage: 350, inTime: '07:00 AM', outTime: '04:00 PM', workData: '80 cu.m' }
        ],
        materials: [
          { name: 'M.Sand', quantity: '200', unit: 'cu.m', cost: 'â‚¹1500/cu.m' },
          { name: 'Brick', quantity: '2000', unit: 'pcs', cost: 'â‚¹6/pc' }
        ]
      },
      'electrical': { 
        icon: 'fa-bolt', 
        workers: [
          { name: 'Ramesh Electrician', role: 'Electrician', wage: 700, inTime: '08:00 AM', outTime: '05:00 PM', workData: '500 meter' },
          { name: 'Dinesh', role: 'Helper', wage: 400, inTime: '08:00 AM', outTime: '05:00 PM', workData: '600 meter' }
        ],
        materials: [
          { name: 'Wire', quantity: '500', unit: 'meter', cost: 'â‚¹150/meter' },
          { name: 'Switch', quantity: '50', unit: 'pcs', cost: 'â‚¹250/pc' },
          { name: 'Meter', quantity: '5', unit: 'pcs', cost: 'â‚¹3000/pc' },
          { name: 'Pipe', quantity: '100', unit: 'meter', cost: 'â‚¹200/meter' }
        ]
      },
      'plumbing': { 
        icon: 'fa-droplet', 
        workers: [
          { name: 'Santosh Plumber', role: 'Plumber', wage: 650, inTime: '08:00 AM', outTime: '05:00 PM', workData: '300 meter' },
          { name: 'Rahul', role: 'Helper', wage: 400, inTime: '08:00 AM', outTime: '05:00 PM', workData: '250 meter' }
        ],
        materials: [
          { name: 'Pipe', quantity: '300', unit: 'meter', cost: 'â‚¹200/meter' },
          { name: 'Jally', quantity: '100', unit: 'pcs', cost: 'â‚¹50/pc' },
          { name: 'Meter', quantity: '3', unit: 'pcs', cost: 'â‚¹3000/pc' },
          { name: 'Cement', quantity: '20', unit: 'bags', cost: 'â‚¹350/bag' }
        ]
      },
      'carpentry': { 
        icon: 'fa-screwdriver-wrench', 
        workers: [
          { name: 'Anil Carpenter', role: 'Carpenter', wage: 600, inTime: '08:00 AM', outTime: '05:00 PM', workData: '50 cu.ft' },
          { name: 'Manoj', role: 'Helper', wage: 400, inTime: '08:00 AM', outTime: '05:00 PM', workData: '40 cu.ft' }
        ],
        materials: [
          { name: 'Steel', quantity: '2', unit: 'ton', cost: 'â‚¹45000/ton' },
          { name: 'Jally', quantity: '50', unit: 'pcs', cost: 'â‚¹50/pc' },
          { name: 'Cement', quantity: '15', unit: 'bags', cost: 'â‚¹350/bag' }
        ]
      },
      'tiling': { 
        icon: 'fa-table-cells', 
        workers: [
          { name: 'Sunil Tiles', role: 'Tiles Expert', wage: 650, inTime: '08:00 AM', outTime: '05:00 PM', workData: '200 sq.m' },
          { name: 'Deepak', role: 'Helper', wage: 400, inTime: '08:00 AM', outTime: '05:00 PM', workData: '180 sq.m' }
        ],
        materials: [
          { name: 'Tiles', quantity: '1000', unit: 'pcs', cost: 'â‚¹500/pcs' },
          { name: 'Cement', quantity: '30', unit: 'bags', cost: 'â‚¹350/bag' },
          { name: 'M.Sand', quantity: '50', unit: 'cu.m', cost: 'â‚¹1500/cu.m' }
        ]
      },
      'jally': { 
        icon: 'fa-grip', 
        workers: [
          { name: 'Pankaj Jally', role: 'Jally Work', wage: 550, inTime: '08:00 AM', outTime: '05:00 PM', workData: '100 pcs' },
          { name: 'Sanjay', role: 'Helper', wage: 400, inTime: '08:00 AM', outTime: '05:00 PM', workData: '80 pcs' }
        ],
        materials: [
          { name: 'Jally', quantity: '500', unit: 'pcs', cost: 'â‚¹50/pc' },
          { name: 'Steel', quantity: '3', unit: 'ton', cost: 'â‚¹45000/ton' },
          { name: 'Cement', quantity: '20', unit: 'bags', cost: 'â‚¹350/bag' }
        ]
      },
      'grill': { 
        icon: 'fa-bars', 
        workers: [
          { name: 'Mahesh Grill', role: 'Grill Expert', wage: 600, inTime: '08:00 AM', outTime: '05:00 PM', workData: '50 window' },
          { name: 'Ajay', role: 'Helper', wage: 400, inTime: '08:00 AM', outTime: '05:00 PM', workData: '45 window' }
        ],
        materials: [
          { name: 'Steel', quantity: '5', unit: 'ton', cost: 'â‚¹45000/ton' },
          { name: 'Paint', quantity: '50', unit: 'liter', cost: 'â‚¹500/liter' }
        ]
      },
      'painting': { 
        icon: 'fa-paint-roller', 
        workers: [
          { name: 'Krishna Painter', role: 'Painter', wage: 550, inTime: '08:00 AM', outTime: '05:00 PM', workData: '500 sq.m' },
          { name: 'Vishal', role: 'Helper', wage: 400, inTime: '08:00 AM', outTime: '05:00 PM', workData: '450 sq.m' }
        ],
        materials: [
          { name: 'Paint', quantity: '100', unit: 'liter', cost: 'â‚¹500/liter' },
          { name: 'Primer', quantity: '50', unit: 'liter', cost: 'â‚¹300/liter' },
          { name: 'Putty', quantity: '100', unit: 'kg', cost: 'â‚¹200/kg' }
        ]
      }
    };

    async function loadAllSites() {
      const grid = document.getElementById('allSitesGrid');
      const sites = [
        { id: 1, name: 'Site 1 - Foundation Work', code: 'SITE001', location: 'Bangalore' },
        { id: 2, name: 'Site 2 - Structural Work', code: 'SITE002', location: 'Bangalore' },
        { id: 3, name: 'Site 3 - Finishing', code: 'SITE003', location: 'Delhi' },
        { id: 4, name: 'Site 4 - Plumbing', code: 'SITE004', location: 'Mumbai' },
        { id: 5, name: 'Site 5 - Electrical', code: 'SITE005', location: 'Hyderabad' },
        { id: 6, name: 'Site 6 - Landscaping', code: 'SITE006', location: 'Pune' },
        { id: 7, name: 'Site 7 - Painting', code: 'SITE007', location: 'Chennai' },
        { id: 8, name: 'Site 8 - Roofing', code: 'SITE008', location: 'Kolkata' },
        { id: 9, name: 'Site 9 - Interiors', code: 'SITE009', location: 'Ahmedabad' },
        { id: 10, name: 'Site 10 - Finalization', code: 'SITE010', location: 'Chandigarh' }
      ];

      grid.innerHTML = sites.map(s => `
        <div class="site-card" style="cursor: pointer;" onclick="selectSite('${s.id}')">
          <div class="site-header">
            <div class="site-name">${s.name}</div>
            <div class="site-code">${s.code}</div>
          </div>
          <div class="list">
            <div class="list-item"><i class="fas fa-map-marker-alt"></i><strong>${s.location}</strong></div>
          </div>
          <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #f0f0f0;">
            <a href="sites.html?site_id=${s.id}" style="background: #007bff; color: white; padding: 8px 16px; border-radius: 4px; text-decoration: none; display: block; text-align: center;">View Details</a>
          </div>
        </div>
      `).join('');
    }

    function selectSite(sid) {
      window.location.href = `sites.html?site_id=${sid}`;
    }

    function setInitialSiteFromParam() {
      const sid = getParam('site_id');
      if (sid) {
        currentSiteId = sid;
        const sel = document.getElementById('filterSite');
        if (sel) sel.value = sid;
        displaySiteDetails(sid);
      }
    }

    function displaySiteDetails(sid) {
      const sites = [
        { id: 1, name: 'Site 1 - Foundation Work', code: 'SITE001', location: 'Bangalore' },
        { id: 2, name: 'Site 2 - Structural Work', code: 'SITE002', location: 'Bangalore' },
        { id: 3, name: 'Site 3 - Finishing', code: 'SITE003', location: 'Delhi' },
        { id: 4, name: 'Site 4 - Plumbing', code: 'SITE004', location: 'Mumbai' },
        { id: 5, name: 'Site 5 - Electrical', code: 'SITE005', location: 'Hyderabad' },
        { id: 6, name: 'Site 6 - Landscaping', code: 'SITE006', location: 'Pune' },
        { id: 7, name: 'Site 7 - Painting', code: 'SITE007', location: 'Chennai' },
        { id: 8, name: 'Site 8 - Roofing', code: 'SITE008', location: 'Kolkata' },
        { id: 9, name: 'Site 9 - Interiors', code: 'SITE009', location: 'Ahmedabad' },
        { id: 10, name: 'Site 10 - Finalization', code: 'SITE010', location: 'Chandigarh' }
      ];
      
      const site = sites.find(s => s.id == sid);
      if (!site) return;

      document.getElementById('siteDetailsSection').style.display = 'block';
      document.getElementById('currentSiteName').textContent = site.name;

      // Get all contractors for this site (all 10 work types)
      const contractors = [
        { name: 'Civil Work Contractor', specialty: 'civil', specialtyLabel: 'Civil Work' },
        { name: 'Centring Work Contractor', specialty: 'centring', specialtyLabel: 'Centring Work' },
        { name: 'Sand Filling Contractor', specialty: 'sand-filling', specialtyLabel: 'Sand Filling' },
        { name: 'Electrical Contractor', specialty: 'electrical', specialtyLabel: 'Electrical Work' },
        { name: 'Plumber Contractor', specialty: 'plumbing', specialtyLabel: 'Plumbing Work' },
        { name: 'Carpenter Contractor', specialty: 'carpentry', specialtyLabel: 'Carpentry Work' },
        { name: 'Tiles Layer Contractor', specialty: 'tiling', specialtyLabel: 'Tiles Work' },
        { name: 'Jally Contractor', specialty: 'jally', specialtyLabel: 'Jally Work' },
        { name: 'Grill Contractor', specialty: 'grill', specialtyLabel: 'Grill Work' },
        { name: 'Painter Contractor', specialty: 'painting', specialtyLabel: 'Painting Work' }
      ];

      const container = document.getElementById('workTypesContainer');
      container.innerHTML = contractors.map((contractor, idx) => {
        const workType = workTypeData[contractor.specialty];
        const workers = workType ? workType.workers : [];
        const icon = workType ? workType.icon : 'fa-briefcase';
        
        return `
          <div class="work-type-box">
            <div class="work-type-header" onclick="toggleWorkDetails(${idx})" style="cursor: pointer;">
              <div class="work-type-title">
                <i class="fas ${icon}"></i>
                <span style="color: #007bff; font-weight: 600; cursor: pointer;">${contractor.specialtyLabel}</span>
                <span style="color: #6c757d; margin: 0 8px;">-</span>
                <span style="cursor: pointer;" onclick="event.stopPropagation(); toggleWorkDetails(${idx});">${contractor.name}</span>
              </div>
              <div>
                <span class="work-type-badge">${workers.length} Workers</span>
                <i class="fas fa-chevron-down" id="icon-${idx}" style="margin-left: 10px; transition: transform 0.2s; transform: rotate(180deg);"></i>
              </div>
            </div>
            <div class="work-details expanded" id="details-${idx}">
              <div style="margin-bottom: 15px; padding: 12px; background: #e7f3ff; border-radius: 4px; border-left: 4px solid #007bff;">
                <strong style="color: #0056b3;">Contractor:</strong> ${contractor.name}<br>
                <strong style="color: #0056b3;">Work Type:</strong> ${contractor.specialtyLabel}<br>
                <strong style="color: #0056b3;">Total Workers:</strong> ${workers.length}
              </div>

              <h4 style="margin: 15px 0 10px 0; color: #2c3e50; font-size: 14px; border-bottom: 2px solid #007bff; padding-bottom: 5px;">ðŸ‘· Workers & Work Data:</h4>
              ${workers.map((w, widx) => `
                <div class="worker-item" style="background: #f8f9fa; margin-bottom: 10px; padding: 12px; border-left: 3px solid #28a745;">
                  <div style="flex: 1;">
                    <div class="worker-name" style="font-weight: 600; color: #2c3e50;"><i class="fas fa-user-hard-hat"></i> ${w.name}</div>
                    <div style="font-size: 13px; color: #6c757d; margin-top: 4px;">
                      <span style="background: #e9ecef; padding: 2px 8px; border-radius: 4px; margin-right: 8px;">${w.role}</span>
                      <i class="fas fa-clock"></i> ${w.inTime} - ${w.outTime}
                    </div>
                    <div style="font-size: 13px; color: #495057; margin-top: 4px;">
                      <i class="fas fa-chart-bar"></i> Work Data: <strong>${w.workData}</strong>
                    </div>
                  </div>
                  <div style="text-align: right;">
                    <span style="color: #28a745; font-weight: 700; font-size: 16px;">â‚¹${w.wage}/day</span>
                  </div>
                </div>
              `).join('')}

              <h4 style="margin: 20px 0 10px 0; color: #2c3e50; font-size: 14px; border-bottom: 2px solid #007bff; padding-bottom: 5px;">ðŸ“¦ Material Details:</h4>
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                ${workTypeData[contractor.specialty].materials.map(m => `
                  <div style="background: #fff3cd; padding: 10px; border-radius: 4px; border-left: 3px solid #ffc107;">
                    <div style="font-weight: 600; color: #2c3e50; font-size: 13px;"><i class="fas fa-box"></i> ${m.name}</div>
                    <div style="font-size: 12px; color: #6c757d; margin-top: 4px;">
                      Qty: <strong>${m.quantity} ${m.unit}</strong><br>
                      Cost: <strong>${m.cost}</strong>
                    </div>
                  </div>
                `).join('')}
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    function toggleWorkDetails(idx) {
      const details = document.getElementById(`details-${idx}`);
      const icon = document.getElementById(`icon-${idx}`);
      
      if (details.classList.contains('expanded')) {
        details.classList.remove('expanded');
        icon.style.transform = 'rotate(0deg)';
      } else {
        details.classList.add('expanded');
        icon.style.transform = 'rotate(180deg)';
      }
    }

    // Initialize
    loadAllSites();
    setInitialSiteFromParam();
  </script>
</body>
</html>