
<!DOCTYPE html>
<html>
<head>
<title>Labour & Contractor Management</title>
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="js/auth.js"></script>
<style>
.workers-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
.worker-card { background: #fff; border-radius: 8px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s; }
.worker-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
.worker-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
.worker-name { font-size: 18px; font-weight: 600; color: #2c3e50; }
.worker-code { font-size: 14px; color: #6c757d; padding: 4px 8px; background: #e9ecef; border-radius: 4px; }
.worker-skill { display: inline-block; padding: 4px 12px; background: #007bff; color: #fff; border-radius: 12px; font-size: 12px; margin: 5px 0; text-transform: capitalize; }
.worker-info { margin: 10px 0; }
.worker-info div { padding: 6px 0; display: flex; align-items: center; font-size: 14px; color: #495057; }
.worker-info i { width: 20px; color: #6c757d; margin-right: 8px; }
.worker-wage { font-size: 16px; font-weight: 600; color: #28a745; margin-top: 10px; }
.worker-actions { display: flex; gap: 10px; margin-top: 15px; }
.btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; transition: all 0.2s; }
.btn-primary { background: #007bff; color: #fff; }
.btn-primary:hover { background: #0056b3; }
.btn-success { background: #28a745; color: #fff; }
.btn-success:hover { background: #218838; }
.btn-danger { background: #dc3545; color: #fff; }
.btn-danger:hover { background: #c82333; }
.status-badge { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; }
.status-active { background: #d4edda; color: #155724; }
.status-inactive { background: #f8d7da; color: #721c24; }
.filter-bar { background: #fff; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; gap: 15px; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.08); }
.filter-bar select, .filter-bar input { padding: 8px 12px; border: 1px solid #ced4da; border-radius: 4px; font-size: 14px; }
</style>
</head>
<body>
<div class="sidebar">
<h2 class="sidebar-brand">Labour CRM</h2>
<nav class="sidebar-nav">
<a href="dashboard.html" class="sidebar-item"><i class="fas fa-home"></i><span>Dashboard</span></a>
<a href="workers.html" class="sidebar-item active"><i class="fas fa-users"></i><span>Labour / Contractors</span></a>
<a href="attendance.html" class="sidebar-item"><i class="fas fa-calendar-check"></i><span>Attendance</span></a>
<a href="payments.html" class="sidebar-item"><i class="fas fa-money-bill-wave"></i><span>Wages & Payments</span></a>
<a href="projects.html" class="sidebar-item"><i class="fas fa-building"></i><span>Projects</span></a>
<a href="reports.html" class="sidebar-item"><i class="fas fa-chart-bar"></i><span>Reports</span></a>
</nav>
</div>

<div class="content">
<div class="header">
<div class="header-left">
<h1>Labour & Contractor Management</h1>
</div>
<div class="header-right">
<button class="btn btn-primary" onclick="showAddWorkerForm()"><i class="fas fa-plus"></i> Add Worker</button>
</div>
</div>

<div class="filter-bar">
<select id="filterSkill" onchange="loadWorkers()">
<option value="">All Skills</option>
<option value="mason">Mason</option>
<option value="carpenter">Carpenter</option>
<option value="electrician">Electrician</option>
<option value="plumber">Plumber</option>
<option value="painter">Painter</option>
<option value="helper">Helper</option>
</select>
<select id="filterStatus" onchange="loadWorkers()">
<option value="true">Active</option>
<option value="false">Inactive</option>
<option value="">All</option>
</select>
<select id="filterSite" onchange="loadWorkers()">
  <option value="">All Sites</option>
  <option value="1">Site 1</option>
  <option value="2">Site 2</option>
  <option value="3">Site 3</option>
  <option value="4">Site 4</option>
  <option value="5">Site 5</option>
  <option value="6">Site 6</option>
  <option value="7">Site 7</option>
  <option value="8">Site 8</option>
  <option value="9">Site 9</option>
  <option value="10">Site 10</option>
  </select>
<input type="search" id="searchWorker" placeholder="Search by name or code..." onkeyup="searchWorkers()" />
</div>

<div class="workers-grid" id="workersGrid">
<p>Loading workers...</p>
</div>
</div>

<script>
let allWorkers = [];

async function loadWorkers() {
  try {
    const skill = document.getElementById('filterSkill').value;
    const status = document.getElementById('filterStatus').value;
    
    let url = '/api/labour/workers?';
    if (skill) url += `skill_type=${skill}&`;
    if (status !== '') url += `is_active=${status}`;
    const siteId = document.getElementById('filterSite').value;
    if (siteId) url += `&site_id=${siteId}`;

    // For now, show sample data since DB is not configured
    allWorkers = [
      { id: 1, worker_code: 'W001', full_name: 'Ravi Kumar', skill_type: 'mason', mobile: '+91 98765 43210', daily_wage: 800, is_active: true, joining_date: '2024-01-15', site_id: 1, site_name: 'Site 1' },
      { id: 2, worker_code: 'W002', full_name: 'Suresh Babu', skill_type: 'carpenter', mobile: '+91 98765 43211', daily_wage: 750, is_active: true, joining_date: '2024-02-01', site_id: 2, site_name: 'Site 2' },
      { id: 3, worker_code: 'W003', full_name: 'Mohan Singh', skill_type: 'electrician', mobile: '+91 98765 43212', daily_wage: 900, is_active: true, joining_date: '2024-01-20', site_id: 1, site_name: 'Site 1' },
      { id: 4, worker_code: 'W004', full_name: 'Prakash Reddy', skill_type: 'plumber', mobile: '+91 98765 43213', daily_wage: 850, is_active: true, joining_date: '2024-03-05', site_id: 3, site_name: 'Site 3' },
      { id: 5, worker_code: 'W005', full_name: 'Vijay Kumar', skill_type: 'painter', mobile: '+91 98765 43214', daily_wage: 700, is_active: true, joining_date: '2024-02-15', site_id: 2, site_name: 'Site 2' },
      { id: 6, worker_code: 'W006', full_name: 'Ramesh Yadav', skill_type: 'helper', mobile: '+91 98765 43215', daily_wage: 500, is_active: true, joining_date: '2024-03-01', site_id: 1, site_name: 'Site 1' }
    ];
    
    displayWorkers(allWorkers);
  } catch (error) {
    console.error('Load workers error:', error);
    document.getElementById('workersGrid').innerHTML = '<p>Error loading workers. Check console.</p>';
  }
}

function displayWorkers(workers) {
  const grid = document.getElementById('workersGrid');
  if (workers.length === 0) {
    grid.innerHTML = '<p>No workers found</p>';
    return;
  }
  
  grid.innerHTML = workers.map(w => `
    <div class="worker-card">
      <div class="worker-header">
        <div class="worker-name">${w.full_name}</div>
        <div class="worker-code">${w.worker_code}</div>
      </div>
      <div class="worker-skill">${w.skill_type}</div>
      <span class="status-badge ${w.is_active ? 'status-active' : 'status-inactive'}">
        ${w.is_active ? 'Active' : 'Inactive'}
      </span>
      <div class="worker-info">
        <div><i class="fas fa-phone"></i>${w.mobile}</div>
        <div><i class="fas fa-location-dot"></i>Site: ${w.site_name || 'N/A'}</div>
        <div><i class="fas fa-calendar"></i>Joined: ${w.joining_date || 'N/A'}</div>
      </div>
      <div class="worker-wage">â‚¹${w.daily_wage}/day</div>
      <div class="worker-actions">
        <button class="btn btn-success" onclick="markAttendance(${w.id})"><i class="fas fa-check"></i> Mark Present</button>
        <button class="btn btn-primary" onclick="editWorker(${w.id})"><i class="fas fa-edit"></i></button>
      </div>
    </div>
  `).join('');
}

function searchWorkers() {
  const query = document.getElementById('searchWorker').value.toLowerCase();
  const filtered = allWorkers.filter(w => 
    w.full_name.toLowerCase().includes(query) || 
    w.worker_code.toLowerCase().includes(query)
  );
  displayWorkers(filtered);
}

function showAddWorkerForm() {
  alert('Add Worker form - to be implemented with modal/new page');
}

function editWorker(id) {
  alert(`Edit worker ${id} - to be implemented`);
}

function markAttendance(id) {
  alert(`Mark attendance for worker ${id} - to be implemented`);
}

// Load workers on page load
loadWorkers();
</script>
</body>
</html>
